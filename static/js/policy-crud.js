function w(o,i,c,t,e,n,a){try{var s=o[n](a),l=s.value}catch(r){c(r);return}s.done?i(l):Promise.resolve(l).then(t,e)}function S(o){return function(){var i=this,c=arguments;return new Promise(function(t,e){var n=o.apply(i,c);function a(l){w(n,t,e,a,s,"next",l)}function s(l){w(n,t,e,a,s,"throw",l)}a(void 0)})}}function I(o,i,c){return i in o?Object.defineProperty(o,i,{value:c,enumerable:!0,configurable:!0,writable:!0}):o[i]=c,o}function O(o){for(var i=1;i<arguments.length;i++){var c=arguments[i]!=null?arguments[i]:{},t=Object.keys(c);typeof Object.getOwnPropertySymbols=="function"&&(t=t.concat(Object.getOwnPropertySymbols(c).filter(function(e){return Object.getOwnPropertyDescriptor(c,e).enumerable}))),t.forEach(function(e){I(o,e,c[e])})}return o}function x(o,i){var c=Object.keys(o);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(o);i&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})),c.push.apply(c,t)}return c}function E(o,i){return i=i??{},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):x(Object(i)).forEach(function(c){Object.defineProperty(o,c,Object.getOwnPropertyDescriptor(i,c))}),o}function L(o){"@swc/helpers - typeof";return o&&typeof Symbol<"u"&&o.constructor===Symbol?"symbol":typeof o}function P(o,i){var c,t,e,n={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(r){return function(u){return l([r,u])}}function l(r){if(c)throw new TypeError("Generator is already executing.");for(;a&&(a=0,r[0]&&(n=0)),n;)try{if(c=1,t&&(e=r[0]&2?t.return:r[0]?t.throw||((e=t.return)&&e.call(t),0):t.next)&&!(e=e.call(t,r[1])).done)return e;switch(t=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return n.label++,{value:r[1],done:!1};case 5:n.label++,t=r[1],r=[0];continue;case 7:r=n.ops.pop(),n.trys.pop();continue;default:if(e=n.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){n=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){n.label=r[1];break}if(r[0]===6&&n.label<e[1]){n.label=e[1],e=r;break}if(e&&n.label<e[2]){n.label=e[2],n.ops.push(r);break}e[2]&&n.ops.pop(),n.trys.pop();continue}r=i.call(o,n)}catch(u){r=[6,u],t=0}finally{c=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}}var h=null;function _(){return S(function(){var o,i,c;return P(this,function(t){switch(t.label){case 0:if(h)return[2,h];t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch("/admin/api/csrf-token")];case 2:if(o=t.sent(),!o.ok)throw new Error("Failed to fetch CSRF token");return[4,o.json()];case 3:return i=t.sent(),h=i.csrf_token,[2,h];case 4:throw c=t.sent(),console.error("Error fetching CSRF token:",c),c;case 5:return[2]}})})()}function p(o){return S(function(i){var c,t,e,n=arguments;return P(this,function(a){switch(a.label){case 0:return c=n.length>1&&n[1]!==void 0?n[1]:{},[4,_()];case 1:return t=a.sent(),e=E(O({},c.headers),{"X-CSRF-Token":t}),c.body&&L(c.body)==="object"&&(e["Content-Type"]="application/json",c.body=JSON.stringify(c.body)),[2,fetch(i,E(O({},c),{headers:e}))]}})}).apply(this,arguments)}function k(o,i,c,t,e,n,a){try{var s=o[n](a),l=s.value}catch(r){c(r);return}s.done?i(l):Promise.resolve(l).then(t,e)}function b(o){return function(){var i=this,c=arguments;return new Promise(function(t,e){var n=o.apply(i,c);function a(l){k(n,t,e,a,s,"next",l)}function s(l){k(n,t,e,a,s,"throw",l)}a(void 0)})}}function g(o,i){return i!=null&&typeof Symbol<"u"&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](o):o instanceof i}function C(o){"@swc/helpers - typeof";return o&&typeof Symbol<"u"&&o.constructor===Symbol?"symbol":typeof o}function v(o,i){var c,t,e,n={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(r){return function(u){return l([r,u])}}function l(r){if(c)throw new TypeError("Generator is already executing.");for(;a&&(a=0,r[0]&&(n=0)),n;)try{if(c=1,t&&(e=r[0]&2?t.return:r[0]?t.throw||((e=t.return)&&e.call(t),0):t.next)&&!(e=e.call(t,r[1])).done)return e;switch(t=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return n.label++,{value:r[1],done:!1};case 5:n.label++,t=r[1],r=[0];continue;case 7:r=n.ops.pop(),n.trys.pop();continue;default:if(e=n.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){n=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){n.label=r[1];break}if(r[0]===6&&n.label<e[1]){n.label=e[1],e=r;break}if(e&&n.label<e[2]){n.label=e[2],n.ops.push(r);break}e[2]&&n.ops.pop(),n.trys.pop();continue}r=i.call(o,n)}catch(u){r=[6,u],t=0}finally{c=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}}function D(o){return b(function(){var i,c,t,e;return v(this,function(n){switch(n.label){case 0:if(!confirm('Are you sure you want to delete policy "'.concat(o,'"?')))return[2];n.label=1;case 1:return n.trys.push([1,5,,6]),[4,p("/admin/api/policies/".concat(o),{method:"DELETE"})];case 2:return i=n.sent(),i.ok?[3,4]:[4,i.text()];case 3:throw c=n.sent(),new Error("Failed to delete policy: ".concat(c));case 4:return window.location.href="/admin/policies",[3,6];case 5:return t=n.sent(),console.error("Error deleting policy:",t),e=g(t,Error)?t.message:String(t),alert("Error deleting policy: ".concat(e)),[3,6];case 6:return[2]}})})()}function B(o,i,c){return b(function(){var t,e,n,a,s,l,r,u,f,d,y;return v(this,function(m){switch(m.label){case 0:return m.trys.push([0,4,,5]),t="/admin/api/policies",e=i==="update"?"PUT":"POST",n={name:o,policy:c},[4,p(t,{method:e,body:n})];case 1:return a=m.sent(),[4,a.json()];case 2:if(s=m.sent(),!a.ok||"error"in s)throw l=s,console.error("Error saving policy: ".concat(l.error)),new Error(JSON.stringify(l));return console.debug("Policy saved successfully method=".concat(e," name=").concat(o)),[4,a.json()];case 3:return r=m.sent(),[2,r];case 4:if(u=m.sent(),console.error("Error saving policy:",u),f=g(u,Error)?JSON.parse(u.message):{error:String(u)},d=C(f.error)==="object"?JSON.stringify(f.error):"".concat(f.error)||"An unknown error occurred",y=document.getElementById("error-notification"),y){for(y.textContent=d;y.classList.contains("error-notification-hide");)y.classList.remove("error-notification-hide");y.classList.remove("error-notification-empty")}else console.error("Error notification element not found");throw u;case 5:return[2]}})})()}function F(){var o=document.getElementById("policy-form");o&&o.addEventListener("submit",function(i){return b(function(){var c,t,e,n,a,s,l,r,u,f;return v(this,function(d){switch(d.label){case 0:console.debug("Submitting policy form"),i.preventDefault(),c=document.getElementById("policy-name"),t=document.getElementById("policy-json"),e=document.getElementById("policy-action"),n=encodeURIComponent(c.value),a=t.value,s=e.value,d.label=1;case 1:return d.trys.push([1,3,,4]),l=JSON.parse(a),[4,B(n,s,l).then(function(y){console.debug("Policy saved successfully: ".concat(JSON.stringify(y))),window.location.href="/admin/policies/view/".concat(n)}).catch(function(y){console.error("Error saving policy: ".concat(y))})];case 2:return d.sent(),[3,4];case 3:if(r=d.sent(),u=g(r,Error)?r.message:String(r),f=document.getElementById("error-notification"),f){for(f.textContent=u;f.classList.contains("error-notification-hide");)f.classList.remove("error-notification-hide");f.classList.remove("error-notification-empty")}else console.error("Error notification element not found");return[3,4];case 4:return[2]}})})()})}function T(){var o=document.getElementById("delete-policy-btn");o&&o.addEventListener("click",function(i){i.preventDefault();var c=o.dataset.policyName;c&&D(c)})}function j(){var o=document.getElementsByClassName("error-notification");Array.from(o).forEach(function(i){console.debug(i.textContent.trim().length),i.textContent.trim().length==0?(console.debug("error notification is empty"),i.classList.add("error-notification-hide")):(console.debug("error notification is not empty"),i.classList.remove("error-notification-hide"))}),F(),T(),console.debug("Finished startup")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",j):j();
