function b(c,i,o,t,e,n,a){try{var u=c[n](a),l=u.value}catch(r){o(r);return}u.done?i(l):Promise.resolve(l).then(t,e)}function w(c){return function(){var i=this,o=arguments;return new Promise(function(t,e){var n=c.apply(i,o);function a(l){b(n,t,e,a,u,"next",l)}function u(l){b(n,t,e,a,u,"throw",l)}a(void 0)})}}function E(c,i,o){return i in c?Object.defineProperty(c,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):c[i]=o,c}function p(c){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{},t=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(t=t.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),t.forEach(function(e){E(c,e,o[e])})}return c}function S(c,i){var o=Object.keys(c);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(c);i&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(c,e).enumerable})),o.push.apply(o,t)}return o}function m(c,i){return i=i??{},Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(i)):S(Object(i)).forEach(function(o){Object.defineProperty(c,o,Object.getOwnPropertyDescriptor(i,o))}),c}function k(c){"@swc/helpers - typeof";return c&&typeof Symbol<"u"&&c.constructor===Symbol?"symbol":typeof c}function g(c,i){var o,t,e,n={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=u(0),a.throw=u(1),a.return=u(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(r){return function(s){return l([r,s])}}function l(r){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,r[0]&&(n=0)),n;)try{if(o=1,t&&(e=r[0]&2?t.return:r[0]?t.throw||((e=t.return)&&e.call(t),0):t.next)&&!(e=e.call(t,r[1])).done)return e;switch(t=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return n.label++,{value:r[1],done:!1};case 5:n.label++,t=r[1],r=[0];continue;case 7:r=n.ops.pop(),n.trys.pop();continue;default:if(e=n.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){n=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){n.label=r[1];break}if(r[0]===6&&n.label<e[1]){n.label=e[1],e=r;break}if(e&&n.label<e[2]){n.label=e[2],n.ops.push(r);break}e[2]&&n.ops.pop(),n.trys.pop();continue}r=i.call(c,n)}catch(s){r=[6,s],t=0}finally{o=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}}var f=null;function j(){return w(function(){var c,i,o;return g(this,function(t){switch(t.label){case 0:if(f)return[2,f];t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch("/admin/api/csrf-token")];case 2:if(c=t.sent(),!c.ok)throw new Error("Failed to fetch CSRF token");return[4,c.json()];case 3:return i=t.sent(),f=i.csrf_token,[2,f];case 4:throw o=t.sent(),console.error("Error fetching CSRF token:",o),o;case 5:return[2]}})})()}function y(c){return w(function(i){var o,t,e,n=arguments;return g(this,function(a){switch(a.label){case 0:return o=n.length>1&&n[1]!==void 0?n[1]:{},[4,j()];case 1:return t=a.sent(),e=m(p({},o.headers),{"X-CSRF-Token":t}),o.body&&k(o.body)==="object"&&(e["Content-Type"]="application/json",o.body=JSON.stringify(o.body)),[2,fetch(i,m(p({},o),{headers:e}))]}})}).apply(this,arguments)}function v(c,i,o,t,e,n,a){try{var u=c[n](a),l=u.value}catch(r){o(r);return}u.done?i(l):Promise.resolve(l).then(t,e)}function d(c){return function(){var i=this,o=arguments;return new Promise(function(t,e){var n=c.apply(i,o);function a(l){v(n,t,e,a,u,"next",l)}function u(l){v(n,t,e,a,u,"throw",l)}a(void 0)})}}function P(c,i){return i!=null&&typeof Symbol<"u"&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](c):c instanceof i}function h(c,i){var o,t,e,n={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=u(0),a.throw=u(1),a.return=u(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(r){return function(s){return l([r,s])}}function l(r){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,r[0]&&(n=0)),n;)try{if(o=1,t&&(e=r[0]&2?t.return:r[0]?t.throw||((e=t.return)&&e.call(t),0):t.next)&&!(e=e.call(t,r[1])).done)return e;switch(t=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return n.label++,{value:r[1],done:!1};case 5:n.label++,t=r[1],r=[0];continue;case 7:r=n.ops.pop(),n.trys.pop();continue;default:if(e=n.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){n=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){n.label=r[1];break}if(r[0]===6&&n.label<e[1]){n.label=e[1],e=r;break}if(e&&n.label<e[2]){n.label=e[2],n.ops.push(r);break}e[2]&&n.ops.pop(),n.trys.pop();continue}r=i.call(c,n)}catch(s){r=[6,s],t=0}finally{o=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}}function x(c){return d(function(){var i,o,t,e;return h(this,function(n){switch(n.label){case 0:if(!confirm('Are you sure you want to delete policy "'.concat(c,'"?')))return[2];n.label=1;case 1:return n.trys.push([1,5,,6]),[4,y("/admin/api/policies/".concat(c),{method:"DELETE"})];case 2:return i=n.sent(),i.ok?[3,4]:[4,i.text()];case 3:throw o=n.sent(),new Error("Failed to delete policy: ".concat(o));case 4:return window.location.href="/admin/policies",[3,6];case 5:return t=n.sent(),console.error("Error deleting policy:",t),e=P(t,Error)?t.message:String(t),alert("Error deleting policy: ".concat(e)),[3,6];case 6:return[2]}})})()}function I(c,i){return d(function(){var o,t,e,n,a,u,l,r;return h(this,function(s){switch(s.label){case 0:return s.trys.push([0,5,,6]),o=c&&c!=="",t=o?"/admin/api/policies/".concat(c):"/admin/api/policies",e=o?"PUT":"POST",n=o?i:{name:c,policy:i},[4,y(t,{method:e,body:n})];case 1:return a=s.sent(),a.ok?[3,3]:[4,a.text()];case 2:throw u=s.sent(),new Error("Failed to save policy: ".concat(u));case 3:return[4,a.json()];case 4:return l=s.sent(),[2,l];case 5:throw r=s.sent(),console.error("Error saving policy:",r),r;case 6:return[2]}})})()}function _(){var c=document.getElementById("policy-form");c&&c.addEventListener("submit",function(i){return d(function(){var o,t,e,n,a,u,l;return h(this,function(r){switch(r.label){case 0:i.preventDefault(),o=document.getElementById("policy-name"),t=document.getElementById("policy-json"),e=encodeURIComponent(o.value),n=t.value,r.label=1;case 1:return r.trys.push([1,3,,4]),a=JSON.parse(n),[4,I(e,a)];case 2:return r.sent(),alert("Policy saved successfully!"),window.location.href="/admin/policies/".concat(e),[3,4];case 3:return u=r.sent(),l=P(u,Error)?u.message:String(u),alert("Error: ".concat(l)),[3,4];case 4:return[2]}})})()})}function D(){var c=document.getElementById("delete-policy-btn");c&&c.addEventListener("click",function(i){i.preventDefault();var o=c.dataset.policyName;o&&x(o)})}function O(){_(),D()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",O):O();
