function L(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,o=new Array(e);t<e;t++)o[t]=n[t];return o}function k(n){if(Array.isArray(n))return n}function A(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var o=[],r=!0,c=!1,d,l;try{for(t=t.call(n);!(r=(d=t.next()).done)&&(o.push(d.value),!(e&&o.length===e));r=!0);}catch(u){c=!0,l=u}finally{try{!r&&t.return!=null&&t.return()}finally{if(c)throw l}}return o}}function j(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(n,e){return k(n)||A(n,e)||O(n,e)||j()}function M(n){"@swc/helpers - typeof";return n&&typeof Symbol<"u"&&n.constructor===Symbol?"symbol":typeof n}function O(n,e){if(n){if(typeof n=="string")return L(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(t);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return L(n,e)}}function R(){var n={};document.querySelectorAll(".form-control").forEach(function(e){e.value.length>0?n[e.id]=e.value:n[e.id]=""}),fetch("/admin/api/policy_troubleshooter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){if("decision"in e&&M(e.decision)==="object"){console.log("Policy check result:",e);var t=document.getElementById("results");if(!t)return;for(;t.firstChild;)t.removeChild(t.firstChild);var o=document.createElement("h3");o.innerHTML='Decision: <span class="badge badge-'.concat(e.decision.decision.toLowerCase(),'">').concat(e.decision.decision,"</span>"),t.appendChild(o);var r=document.createElement("h3");r.textContent="Context:",t.appendChild(r);var c=document.createElement("p"),d=document.createElement("div"),l="";Object.entries(e.decision.context.Principal).forEach(function(i){var s=I(i,2),a=s[0],f=s[1];l+="".concat(a,"(").concat(f,") ")}),d.innerText="Principal: ".concat(l," "),c.appendChild(d);var u=document.createElement("p"),y=document.createElement("div");y.innerText="Action: ".concat(e.decision.context.Action," "),u.appendChild(y),c.appendChild(u);var v=document.createElement("p"),C=document.createElement("div");if(C.innerText="Resource: ".concat(e.decision.context.Resource," "),v.appendChild(C),c.appendChild(v),e.decision.context.Context&&Object.keys(e.decision.context.Context).length>0){var E=document.createElement("p"),_=document.createElement("div");_.innerText="Context: ".concat(JSON.stringify(e.decision.context.Context,null,2)," "),E.appendChild(_),c.appendChild(E)}t.appendChild(c);var b=document.createElement("h3");b.textContent="Matched Statements",t.appendChild(b);var g=document.createElement("div"),h=document.createElement("ul");h.classList=["no-list-style ","list-item-padded"].join(" "),e.decision.matched_statements.forEach(function(i){var s=document.createElement("li"),a=document.createElement("ul");a.classList=["no-list-style"].join(" ");var f=document.createElement("li");f.className="font-weight-bold",f.textContent="Statement ID: ".concat(i.sid," "),a.appendChild(f);var w=document.createElement("li");if(w.innerHTML='Conditions Satisfied: <span class="badge badge-'.concat(i.conditions_satisfied.toString().toLowerCase(),'" > ').concat(i.conditions_satisfied," </span>"),a.appendChild(w),i.conditions_satisfied){var x=document.createElement("li");x.innerHTML='Policy Effect: <span class="badge badge-'.concat(i.effect.toLowerCase(),'">').concat(i.effect,"</span>"),a.appendChild(x)}if(i.reason.trim()!==""&&i.reason){var S=document.createElement("li");S.innerText="Reason: ".concat(i.reason),a.appendChild(S)}s.appendChild(a),h.appendChild(s)}),g.appendChild(h),t.appendChild(g)}else"error"in e&&T(e)}).catch(function(e){T(e)})}var p=0;function m(n){n?console.debug("Debounce timer is still running. Waiting for it to expire."):n=window.setTimeout(function(){n=0,R()},300)}function T(n){console.error("Error checking policy:",n);var e=document.getElementById("results");if(e){for(;e.firstChild;)e.removeChild(e.firstChild);var t=document.createElement("div");t.className="error-container";var o=document.createElement("h1");o.textContent="Error checking policy. Please try again.",t.appendChild(o);var r=document.createElement("p");typeof n=="string"?r.textContent=n:r.textContent=JSON.stringify(n.error),t.appendChild(r),e.appendChild(t)}}document.querySelectorAll(".form-control").forEach(function(n){n.addEventListener("input",function(){var e=new URL(window.location.href);e.searchParams.set(n.id,n.value),console.debug("Updated URL: ".concat(e.toString())),window.history.pushState({},"",e),m(p)})});document.getElementsByName("check_access").forEach(function(n){n.addEventListener("click",function(e){e.preventDefault(),m(p)}),n.addEventListener("submit",function(e){e.preventDefault(),m(p)})});window.addEventListener("load",function(){var n=!1;document.querySelectorAll(".form-control").forEach(function(e){e.value&&(n=!0)}),n&&m(p)});
