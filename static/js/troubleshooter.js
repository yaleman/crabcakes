function L(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=n[t];return i}function N(n){if(Array.isArray(n))return n}function R(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i=[],r=!0,c=!1,a,l;try{for(t=t.call(n);!(r=(a=t.next()).done)&&(i.push(a.value),!(e&&i.length===e));r=!0);}catch(s){c=!0,l=s}finally{try{!r&&t.return!=null&&t.return()}finally{if(c)throw l}}return i}}function U(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function q(n,e){return N(n)||R(n,e)||F(n,e)||U()}function B(n){"@swc/helpers - typeof";return n&&typeof Symbol<"u"&&n.constructor===Symbol?"symbol":typeof n}function F(n,e){if(n){if(typeof n=="string")return L(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(t);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return L(n,e)}}function H(){var n={};document.querySelectorAll(".form-control").forEach(function(e){e.value.length>0?n[e.id]=e.value:n[e.id]=""}),fetch("/admin/api/policy_troubleshooter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){if("decision"in e&&B(e.decision)==="object"){console.log("Policy check result:",e);var t=document.getElementById("results");if(!t)return;for(;t.firstChild;)t.removeChild(t.firstChild);var i=document.createElement("h3");i.innerHTML='Decision: <span class="badge badge-'.concat(e.decision.decision.toLowerCase(),'">').concat(e.decision.decision,"</span>"),t.appendChild(i);var r=document.createElement("h3");r.textContent="Context:",t.appendChild(r);var c=document.createElement("p"),a=document.createElement("div"),l=document.createElement("label");l.htmlFor="principal",l.innerText="Principal: ",a.appendChild(l);var s=document.createElement("span");s.id="principal";var h;Object.entries(e.decision.context.Principal).length===0?h="No principal specified":h=Object.entries(e.decision.context.Principal).map(function(o){var f=q(o,2),d=f[0],p=f[1];return p.replace("::000000000000:",":::")}).join(", "),s.innerText=h,a.appendChild(s),c.appendChild(a);var w=document.createElement("p"),v=document.createElement("div"),y=document.createElement("label");y.htmlFor="action",y.innerText="Action: ",v.appendChild(y);var C=document.createElement("span");C.id="action",C.innerText=e.decision.context.Action,v.appendChild(C),w.appendChild(v),c.appendChild(w);var x=document.createElement("p"),E=document.createElement("div"),_=document.createElement("label");_.htmlFor="resource",_.innerText="Resource: ",E.appendChild(_);var b=document.createElement("span");if(b.id="resource",b.innerText=e.decision.context.Resource,E.appendChild(b),x.appendChild(E),c.appendChild(x),e.decision.context.Context&&Object.keys(e.decision.context.Context).length>0){var S=document.createElement("p"),T=document.createElement("div");T.innerText="Context: ".concat(JSON.stringify(e.decision.context.Context,null,2)," "),S.appendChild(T),c.appendChild(S)}t.appendChild(c);var A=document.createElement("h3");A.textContent="Matched Statements",t.appendChild(A);var j=document.createElement("div"),g=document.createElement("ul");g.classList=["no-list-style ","list-item-padded"].join(" "),e.decision.matched_statements.forEach(function(o){var f=document.createElement("li"),d=document.createElement("ul");d.classList=["no-list-style"].join(" ");var p=document.createElement("li");p.className="font-weight-bold",p.textContent="Statement ID: ".concat(o.sid," "),d.appendChild(p);var k=document.createElement("li");if(k.innerHTML='Conditions Satisfied: <span class="badge badge-'.concat(o.conditions_satisfied.toString().toLowerCase(),'" > ').concat(o.conditions_satisfied," </span>"),d.appendChild(k),o.conditions_satisfied){var O=document.createElement("li");O.innerHTML='Policy Effect: <span class="badge badge-'.concat(o.effect.toLowerCase(),'">').concat(o.effect,"</span>"),d.appendChild(O)}if(o.reason.trim()!==""&&o.reason){var I=document.createElement("li");I.innerText="Reason: ".concat(o.reason),d.appendChild(I)}f.appendChild(d),g.appendChild(f)}),j.appendChild(g),t.appendChild(j)}else"error"in e&&M(e)}).catch(function(e){M(e)})}var m=0;function u(n){n?console.debug("Debounce timer is still running. Waiting for it to expire."):n=window.setTimeout(function(){n=0,H()},300)}function M(n){console.error("Error checking policy:",n);var e=document.getElementById("results");if(e){for(;e.firstChild;)e.removeChild(e.firstChild);var t=document.createElement("div");t.className="error-container";var i=document.createElement("h1");i.textContent="Error checking policy. Please try again.",t.appendChild(i);var r=document.createElement("p");typeof n=="string"?r.textContent=n:r.textContent=JSON.stringify(n.error),t.appendChild(r),e.appendChild(t)}}document.querySelectorAll(".form-control").forEach(function(n){n.addEventListener("input",function(){var e=new URL(window.location.href);e.searchParams.set(n.id,n.value),console.debug("Updated URL: ".concat(e.toString())),window.history.pushState({},"",e),u(m)})});document.getElementsByName("check_access").forEach(function(n){n.addEventListener("click",function(e){e.preventDefault(),u(m)}),n.addEventListener("submit",function(e){e.preventDefault(),u(m)})});window.addEventListener("load",function(){var n=!1;document.querySelectorAll(".form-control").forEach(function(e){e.value&&(n=!0)}),n&&u(m)});
