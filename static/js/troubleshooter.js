function L(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function T(t){if(Array.isArray(t))return t}function k(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var a=[],i=!0,r=!1,d,l;try{for(n=n.call(t);!(i=(d=n.next()).done)&&(a.push(d.value),!(e&&a.length===e));i=!0);}catch(m){r=!0,l=m}finally{try{!i&&n.return!=null&&n.return()}finally{if(r)throw l}}return a}}function A(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function P(t,e){return T(t)||k(t,e)||j(t,e)||A()}function j(t,e){if(t){if(typeof t=="string")return L(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return L(t,e)}}function D(){var t={};document.querySelectorAll(".form-control").forEach(function(e){e.value.length>0?t[e.id]=e.value:e.id!="policy"?t[e.id]="*":t[e.id]=""}),fetch("/admin/api/policy_troubleshooter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(e){return e.json()}).then(function(e){console.log("Policy check result:",e);var n=document.getElementById("results");if(n){for(;n.firstChild;)n.removeChild(n.firstChild);var a=document.createElement("h3");a.innerHTML='Decision: <span class="badge badge-'.concat(e.decision.decision.toLowerCase(),'">').concat(e.decision.decision,"</span>"),n.appendChild(a);var i=document.createElement("h3");i.textContent="Context:",n.appendChild(i);var r=document.createElement("p"),d=document.createElement("div"),l="";Object.entries(e.decision.context.Principal).forEach(function(o){var s=P(o,2),c=s[0],u=s[1];l+="".concat(c,"(").concat(u,")<br />")}),d.innerText="Principal: ".concat(l),r.appendChild(d);var m=document.createElement("p"),v=document.createElement("div");v.innerText="Action: ".concat(e.decision.context.Action),m.appendChild(v),r.appendChild(m);var y=document.createElement("p"),C=document.createElement("div");if(C.innerText="Resource: ".concat(e.decision.context.Resource),y.appendChild(C),r.appendChild(y),e.decision.context.Context&&Object.keys(e.decision.context.Context).length>0){var g=document.createElement("p"),E=document.createElement("div");E.innerText="Context: ".concat(JSON.stringify(e.decision.context.Context,null,2)),g.appendChild(E),r.appendChild(g)}n.appendChild(r);var _=document.createElement("h3");_.textContent="Matched Statements",n.appendChild(_);var b=document.createElement("div"),p=document.createElement("ul");p.classList=["no-list-style ","list-item-padded"].join(" "),e.decision.matched_statements.forEach(function(o){var s=document.createElement("li"),c=document.createElement("ul");c.classList=["no-list-style"].join(" ");var u=document.createElement("li");u.className="font-weight-bold",u.textContent="Statement ID: ".concat(o.sid),c.appendChild(u);var x=document.createElement("li");if(x.innerHTML='Conditions Satisfied: <span class="badge badge-'.concat(o.conditions_satisfied.toString().toLowerCase(),'">').concat(o.conditions_satisfied,"</span>"),c.appendChild(x),o.conditions_satisfied){var w=document.createElement("li");w.innerHTML='Policy Effect: <span class="badge badge-'.concat(o.effect.toLowerCase(),'">').concat(o.effect,"</span>"),c.appendChild(w)}if(o.reason.trim()!==""&&o.reason){var S=document.createElement("li");S.innerText="Reason: ".concat(o.reason),c.appendChild(S)}s.appendChild(c),p.appendChild(s)}),b.appendChild(p),n.appendChild(b)}}).catch(function(e){console.error("Error checking policy:",e);var n=document.getElementById("results");if(n){for(;n.firstChild;)n.removeChild(n.firstChild);var a=document.createElement("div");a.className="error-container";var i=document.createElement("h1");i.textContent="Error checking policy. Please try again.",a.appendChild(i);var r=document.createElement("p");r.textContent=e.toString(),a.appendChild(r),n.appendChild(a)}})}var f=0;function h(t){t?console.debug("Debounce timer is still running. Waiting for it to expire."):t=window.setTimeout(function(){t=0,D()},300)}document.querySelectorAll(".form-control").forEach(function(t){t.addEventListener("input",function(){console.debug("Input changed: ".concat(t.id," = ").concat(t.value));var e=new URL(window.location.href);e.searchParams.set(t.id,t.value),console.debug("Updated URL: ".concat(e.toString())),window.history.pushState({},"",e),h(f)})});document.getElementsByName("check_access").forEach(function(t){t.addEventListener("click",function(e){e.preventDefault(),h(f)}),t.addEventListener("submit",function(e){e.preventDefault(),h(f)})});window.addEventListener("load",function(){var t=!1;document.querySelectorAll(".form-control").forEach(function(e){e.value&&(t=!0)}),t&&h(f)});
