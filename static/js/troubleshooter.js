function L(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,o=new Array(e);t<e;t++)o[t]=n[t];return o}function U(n){if(Array.isArray(n))return n}function q(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var o=[],i=!0,l=!1,c,a;try{for(t=t.call(n);!(i=(c=t.next()).done)&&(o.push(c.value),!(e&&o.length===e));i=!0);}catch(m){l=!0,a=m}finally{try{!i&&t.return!=null&&t.return()}finally{if(l)throw a}}return o}}function B(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function F(n,e){return U(n)||q(n,e)||P(n,e)||B()}function J(n){"@swc/helpers - typeof";return n&&typeof Symbol<"u"&&n.constructor===Symbol?"symbol":typeof n}function P(n,e){if(n){if(typeof n=="string")return L(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(t);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return L(n,e)}}function W(){var n={};document.querySelectorAll(".form-control").forEach(function(e){e.value.length>0?n[e.id]=e.value:n[e.id]=""}),fetch("/admin/api/policy_troubleshooter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){if("decision"in e&&J(e.decision)==="object"){console.log("Policy check result:",e);var t=document.getElementById("results");if(!t)return;for(;t.firstChild;)t.removeChild(t.firstChild);var o=document.createElement("h3"),i=document.createElement("span");i.className="badge badge-".concat(e.decision.decision.toLowerCase()),i.textContent=e.decision.decision,o.appendChild(i),t.appendChild(o);var l=document.createElement("h3");l.textContent="Context:",t.appendChild(l);var c=document.createElement("p"),a=document.createElement("div"),m=document.createElement("label");m.htmlFor="principal",m.innerText="Principal: ",a.appendChild(m);var h=document.createElement("span");h.id="principal";var v;Object.entries(e.decision.context.Principal).length===0?v="No principal specified":v=Object.entries(e.decision.context.Principal).map(function(r){var s=F(r,2),d=s[0],f=s[1];return f.replace("::000000000000:",":::")}).join(", "),h.innerText=v,a.appendChild(h),c.appendChild(a);var T=document.createElement("p"),C=document.createElement("div"),y=document.createElement("label");y.htmlFor="action",y.innerText="Action: ",C.appendChild(y);var E=document.createElement("span");E.id="action",E.innerText=e.decision.context.Action,C.appendChild(E),T.appendChild(C),c.appendChild(T);var A=document.createElement("p"),_=document.createElement("div"),b=document.createElement("label");b.htmlFor="resource",b.innerText="Resource: ",_.appendChild(b);var g=document.createElement("span");if(g.id="resource",g.innerText=e.decision.context.Resource,_.appendChild(g),A.appendChild(_),c.appendChild(A),e.decision.context.Context&&Object.keys(e.decision.context.Context).length>0){var j=document.createElement("p"),k=document.createElement("div");k.innerText="Context: ".concat(JSON.stringify(e.decision.context.Context,null,2)," "),j.appendChild(k),c.appendChild(j)}t.appendChild(c);var N=document.createElement("h3");N.textContent="Matched Statements",t.appendChild(N);var I=document.createElement("div"),x=document.createElement("ul");x.classList=["no-list-style ","list-item-padded"].join(" "),e.decision.matched_statements.forEach(function(r){var s=document.createElement("li"),d=document.createElement("ul");d.classList=["no-list-style"].join(" ");var f=document.createElement("li");f.className="font-weight-bold",f.textContent="Statement ID: ".concat(r.sid," "),d.appendChild(f);var w=document.createElement("li"),S=document.createElement("span");if(S.className="badge badge-".concat(r.conditions_satisfied.toString().toLowerCase()),S.textContent=r.conditions_satisfied.toString(),w.appendChild(document.createTextNode("Conditions Satisfied: ")),w.appendChild(S),d.appendChild(w),r.conditions_satisfied){var O=document.createElement("li");O.innerHTML='Policy Effect: <span class="badge badge-'.concat(r.effect.toLowerCase(),'">').concat(r.effect,"</span>"),d.appendChild(O)}if(r.reason.trim()!==""&&r.reason){var R=document.createElement("li");R.innerText="Reason: ".concat(r.reason),d.appendChild(R)}s.appendChild(d),x.appendChild(s)}),I.appendChild(x),t.appendChild(I)}else"error"in e&&M(e)}).catch(function(e){M(e)})}var p=0;function u(n){n?console.debug("Debounce timer is still running. Waiting for it to expire."):n=window.setTimeout(function(){n=0,W()},300)}function M(n){console.error("Error checking policy:",n);var e=document.getElementById("results");if(e){for(;e.firstChild;)e.removeChild(e.firstChild);var t=document.createElement("div");t.className="error-container";var o=document.createElement("h1");o.textContent="Error checking policy. Please try again.",t.appendChild(o);var i=document.createElement("p");typeof n=="string"?i.textContent=n:i.textContent=JSON.stringify(n.error),t.appendChild(i),e.appendChild(t)}}document.querySelectorAll(".form-control").forEach(function(n){n.addEventListener("input",function(){var e=new URL(window.location.href);e.searchParams.set(n.id,n.value),console.debug("Updated URL: ".concat(e.toString())),window.history.pushState({},"",e),u(p)})});document.getElementsByName("check_access").forEach(function(n){n.addEventListener("click",function(e){e.preventDefault(),u(p)}),n.addEventListener("submit",function(e){e.preventDefault(),u(p)})});window.addEventListener("load",function(){var n=!1;document.querySelectorAll(".form-control").forEach(function(e){e.value&&(n=!0)}),n&&u(p)});
