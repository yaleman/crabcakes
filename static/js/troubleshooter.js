function q(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,o=new Array(e);t<e;t++)o[t]=n[t];return o}function F(n){if(Array.isArray(n))return n}function L(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var o=[],i=!0,l=!1,c,a;try{for(t=t.call(n);!(i=(c=t.next()).done)&&(o.push(c.value),!(e&&o.length===e));i=!0);}catch(m){l=!0,a=m}finally{try{!i&&t.return!=null&&t.return()}finally{if(l)throw a}}return o}}function M(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function J(n,e){return F(n)||L(n,e)||W(n,e)||M()}function P(n){"@swc/helpers - typeof";return n&&typeof Symbol<"u"&&n.constructor===Symbol?"symbol":typeof n}function W(n,e){if(n){if(typeof n=="string")return q(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(t);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return q(n,e)}}function $(){var n={};document.querySelectorAll(".form-control").forEach(function(e){e.value.length>0?n[e.id]=e.value:n[e.id]=""}),fetch("/admin/api/policy_troubleshooter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){if("decision"in e&&P(e.decision)==="object"){console.log("Policy check result:",e);var t=document.getElementById("results");if(!t)return;for(;t.firstChild;)t.removeChild(t.firstChild);var o=document.createElement("h3"),i=document.createElement("span");i.className="badge badge-".concat(e.decision.decision.toLowerCase()),i.textContent=e.decision.decision,o.appendChild(i),t.appendChild(o);var l=document.createElement("h3");l.textContent="Context:",t.appendChild(l);var c=document.createElement("p"),a=document.createElement("div"),m=document.createElement("label");m.htmlFor="principal",m.innerText="Principal: ",a.appendChild(m);var h=document.createElement("span");h.id="principal";var v;Object.entries(e.decision.context.Principal).length===0?v="No principal specified":v=Object.entries(e.decision.context.Principal).map(function(r){var s=J(r,2),d=s[0],p=s[1];return p.replace("::000000000000:",":::")}).join(", "),h.innerText=v,a.appendChild(h),c.appendChild(a);var j=document.createElement("p"),C=document.createElement("div"),y=document.createElement("label");y.htmlFor="action",y.innerText="Action: ",C.appendChild(y);var E=document.createElement("span");E.id="action",E.innerText=e.decision.context.Action,C.appendChild(E),j.appendChild(C),c.appendChild(j);var k=document.createElement("p"),_=document.createElement("div"),b=document.createElement("label");b.htmlFor="resource",b.innerText="Resource: ",_.appendChild(b);var x=document.createElement("span");if(x.id="resource",x.innerText=e.decision.context.Resource,_.appendChild(x),k.appendChild(_),c.appendChild(k),e.decision.context.Context&&Object.keys(e.decision.context.Context).length>0){var N=document.createElement("p"),O=document.createElement("div");O.innerText="Context: ".concat(JSON.stringify(e.decision.context.Context,null,2)," "),N.appendChild(O),c.appendChild(N)}t.appendChild(c);var R=document.createElement("h3");R.textContent="Matched Statements",t.appendChild(R);var I=document.createElement("div"),g=document.createElement("ul");g.classList=["no-list-style ","list-item-padded"].join(" "),e.decision.matched_statements.forEach(function(r){var s=document.createElement("li"),d=document.createElement("ul");d.classList=["no-list-style"].join(" ");var p=document.createElement("li");p.className="font-weight-bold",p.textContent="Statement ID: ".concat(r.sid," "),d.appendChild(p);var w=document.createElement("li"),T=document.createElement("span");if(T.className="badge badge-".concat(r.conditions_satisfied.toString().toLowerCase()),T.textContent=r.conditions_satisfied.toString(),w.appendChild(document.createTextNode("Conditions Satisfied: ")),w.appendChild(T),d.appendChild(w),r.conditions_satisfied){var S=document.createElement("li"),A=document.createElement("span");A.className="badge badge-".concat(r.effect.toLowerCase()),A.textContent=r.effect,S.appendChild(document.createTextNode("Policy Effect: ")),S.appendChild(A),d.appendChild(S)}if(r.reason.trim()!==""&&r.reason){var U=document.createElement("li");U.innerText="Reason: ".concat(r.reason),d.appendChild(U)}s.appendChild(d),g.appendChild(s)}),I.appendChild(g),t.appendChild(I)}else"error"in e&&B(e)}).catch(function(e){B(e)})}var u=0;function f(n){n?console.debug("Debounce timer is still running. Waiting for it to expire."):n=window.setTimeout(function(){n=0,$()},300)}function B(n){console.error("Error checking policy:",n);var e=document.getElementById("results");if(e){for(;e.firstChild;)e.removeChild(e.firstChild);var t=document.createElement("div");t.className="error-container";var o=document.createElement("h1");o.textContent="Error checking policy. Please try again.",t.appendChild(o);var i=document.createElement("p");typeof n=="string"?i.textContent=n:i.textContent=JSON.stringify(n.error),t.appendChild(i),e.appendChild(t)}}document.querySelectorAll(".form-control").forEach(function(n){n.addEventListener("input",function(){var e=new URL(window.location.href);e.searchParams.set(n.id,n.value),console.debug("Updated URL: ".concat(e.toString())),window.history.pushState({},"",e),f(u)})});document.getElementsByName("check_access").forEach(function(n){n.addEventListener("click",function(e){e.preventDefault(),f(u)}),n.addEventListener("submit",function(e){e.preventDefault(),f(u)})});window.addEventListener("load",function(){var n=!1;document.querySelectorAll(".form-control").forEach(function(e){e.value&&(n=!0)}),n&&f(u)});
