function v(c,o,a,r,e,t,i){try{var s=c[t](i),u=s.value}catch(n){a(n);return}s.done?o(u):Promise.resolve(u).then(r,e)}function k(c){return function(){var o=this,a=arguments;return new Promise(function(r,e){var t=c.apply(o,a);function i(u){v(t,r,e,i,s,"next",u)}function s(u){v(t,r,e,i,s,"throw",u)}i(void 0)})}}function I(c,o,a){return o in c?Object.defineProperty(c,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):c[o]=a,c}function g(c){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{},r=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(e){I(c,e,a[e])})}return c}function P(c,o){var a=Object.keys(c);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(c);o&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(c,e).enumerable})),a.push.apply(a,r)}return a}function w(c,o){return o=o??{},Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(o)):P(Object(o)).forEach(function(a){Object.defineProperty(c,a,Object.getOwnPropertyDescriptor(o,a))}),c}function j(c){"@swc/helpers - typeof";return c&&typeof Symbol<"u"&&c.constructor===Symbol?"symbol":typeof c}function E(c,o){var a,r,e,t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(n){return function(l){return u([n,l])}}function u(n){if(a)throw new TypeError("Generator is already executing.");for(;i&&(i=0,n[0]&&(t=0)),t;)try{if(a=1,r&&(e=n[0]&2?r.return:n[0]?r.throw||((e=r.return)&&e.call(r),0):r.next)&&!(e=e.call(r,n[1])).done)return e;switch(r=0,e&&(n=[n[0]&2,e.value]),n[0]){case 0:case 1:e=n;break;case 4:return t.label++,{value:n[1],done:!1};case 5:t.label++,r=n[1],n=[0];continue;case 7:n=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(n[0]===6||n[0]===2)){t=0;continue}if(n[0]===3&&(!e||n[1]>e[0]&&n[1]<e[3])){t.label=n[1];break}if(n[0]===6&&t.label<e[1]){t.label=e[1],e=n;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(n);break}e[2]&&t.ops.pop(),t.trys.pop();continue}n=o.call(c,t)}catch(l){n=[6,l],r=0}finally{a=e=0}if(n[0]&5)throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}var d=null;function x(){return k(function(){var c,o,a;return E(this,function(r){switch(r.label){case 0:if(d)return[2,d];r.label=1;case 1:return r.trys.push([1,4,,5]),[4,fetch("/admin/api/csrf-token")];case 2:if(c=r.sent(),!c.ok)throw new Error("Failed to fetch CSRF token");return[4,c.json()];case 3:return o=r.sent(),d=o.csrf_token,[2,d];case 4:throw a=r.sent(),console.error("Error fetching CSRF token:",a),a;case 5:return[2]}})})()}function m(c){return k(function(o){var a,r,e,t=arguments;return E(this,function(i){switch(i.label){case 0:return a=t.length>1&&t[1]!==void 0?t[1]:{},[4,x()];case 1:return r=i.sent(),e=w(g({},a.headers),{"X-CSRF-Token":r}),a.body&&j(a.body)==="object"&&(e["Content-Type"]="application/json",a.body=JSON.stringify(a.body)),[2,fetch(o,w(g({},a),{headers:e}))]}})}).apply(this,arguments)}function O(c,o,a,r,e,t,i){try{var s=c[t](i),u=s.value}catch(n){a(n);return}s.done?o(u):Promise.resolve(u).then(r,e)}function y(c){return function(){var o=this,a=arguments;return new Promise(function(r,e){var t=c.apply(o,a);function i(u){O(t,r,e,i,s,"next",u)}function s(u){O(t,r,e,i,s,"throw",u)}i(void 0)})}}function h(c,o){return o!=null&&typeof Symbol<"u"&&o[Symbol.hasInstance]?!!o[Symbol.hasInstance](c):c instanceof o}function b(c,o){var a,r,e,t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(n){return function(l){return u([n,l])}}function u(n){if(a)throw new TypeError("Generator is already executing.");for(;i&&(i=0,n[0]&&(t=0)),t;)try{if(a=1,r&&(e=n[0]&2?r.return:n[0]?r.throw||((e=r.return)&&e.call(r),0):r.next)&&!(e=e.call(r,n[1])).done)return e;switch(r=0,e&&(n=[n[0]&2,e.value]),n[0]){case 0:case 1:e=n;break;case 4:return t.label++,{value:n[1],done:!1};case 5:t.label++,r=n[1],n=[0];continue;case 7:n=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(n[0]===6||n[0]===2)){t=0;continue}if(n[0]===3&&(!e||n[1]>e[0]&&n[1]<e[3])){t.label=n[1];break}if(n[0]===6&&t.label<e[1]){t.label=e[1],e=n;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(n);break}e[2]&&t.ops.pop(),t.trys.pop();continue}n=o.call(c,t)}catch(l){n=[6,l],r=0}finally{a=e=0}if(n[0]&5)throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}function C(c){return y(function(){var o,a,r,e;return b(this,function(t){switch(t.label){case 0:if(!confirm('Are you sure you want to delete credential "'.concat(c,'"?')))return[2];t.label=1;case 1:return t.trys.push([1,5,,6]),[4,m("/admin/api/credentials/".concat(c),{method:"DELETE"})];case 2:return o=t.sent(),o.ok?[3,4]:[4,o.text()];case 3:throw a=t.sent(),new Error("Failed to delete credential: ".concat(a));case 4:return window.location.href="/admin/identities",[3,6];case 5:return r=t.sent(),console.error("Error deleting credential:",r),e=h(r,Error)?r.message:String(r),alert("Error deleting credential: ".concat(e)),[3,6];case 6:return[2]}})})()}function D(c,o,a){return y(function(){var r,e,t,i,s,u,n;return b(this,function(l){switch(l.label){case 0:return l.trys.push([0,5,,6]),r=a?"/admin/api/credentials/".concat(c):"/admin/api/credentials",e=a?"PUT":"POST",t=a?{secret_access_key:o}:{access_key_id:c,secret_access_key:o},[4,m(r,{method:e,body:t})];case 1:return i=l.sent(),i.ok?[3,3]:[4,i.text()];case 2:throw s=l.sent(),new Error("Failed to save credential: ".concat(s));case 3:return[4,i.json()];case 4:return u=l.sent(),[2,u];case 5:throw n=l.sent(),console.error("Error saving credential:",n),n;case 6:return[2]}})})()}function T(){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="",a=new Uint8Array(40);crypto.getRandomValues(a);for(var r=0;r<40;r++)o+=c[a[r]%c.length];return o}function F(){var c=document.getElementById("credential-form");if(c){var o=document.getElementById("access-key-id"),a=document.getElementById("secret-access-key"),r=document.getElementById("generate-key-btn"),e=document.getElementById("toggle-visibility-btn");r&&r.addEventListener("click",function(t){t.preventDefault();var i=T();a.value=i,a.type="text"}),e&&e.addEventListener("click",function(t){t.preventDefault(),a.type=a.type==="password"?"text":"password"}),c.addEventListener("submit",function(t){return y(function(){var i,s,u,n,l,p;return b(this,function(f){switch(f.label){case 0:if(t.preventDefault(),i=o.value.trim(),s=a.value,u=o.hasAttribute("readonly"),s.length!==40)return alert("Secret access key must be exactly 40 characters long"),[2];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,D(i,s,u)];case 2:return f.sent(),alert("Credential saved successfully!"),n=encodeURIComponent(i),window.location.href="/admin/identities/".concat(n),[3,4];case 3:return l=f.sent(),p=h(l,Error)?l.message:String(l),alert("Error: ".concat(p)),[3,4];case 4:return[2]}})})()})}}function L(){var c=document.getElementById("delete-credential-btn");c&&c.addEventListener("click",function(o){o.preventDefault();var a=c.dataset.accessKeyId;a&&C(a)})}function _(){var c=document.querySelectorAll(".delete-temp-credential-btn");c.forEach(function(o){o.addEventListener("click",function(a){if(a.preventDefault(),!!h(a.target,HTMLElement)){var r=a.target.dataset.accesskeyid;console.debug("Delete button clicked '".concat(r,"'")),r&&B(r)}})})}function S(){F(),L(),_()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",S):S();function B(c){return y(function(){var o,a,r,e,t;return b(this,function(i){switch(i.label){case 0:if(!confirm("Are you sure you want to delete temporary credential ".concat(c,"?")))return[2];i.label=1;case 1:return i.trys.push([1,8,,9]),[4,fetch("/admin/api/csrf-token")];case 2:return o=i.sent(),[4,o.json()];case 3:return a=i.sent(),[4,fetch(encodeURI("/admin/api/temp_creds/".concat(c)),{method:"DELETE",headers:{"X-CSRF-Token":a.csrf_token}})];case 4:return r=i.sent(),r.ok?(window.location.reload(),[3,7]):[3,5];case 5:return[4,r.json()];case 6:e=i.sent(),alert("Failed to delete credential: ".concat(e.error||"Unknown error")),i.label=7;case 7:return[3,9];case 8:return t=i.sent(),alert("Failed to delete credential: ".concat(h(t,Error)?t.message:String(t))),[3,9];case 9:return[2]}})})()}
