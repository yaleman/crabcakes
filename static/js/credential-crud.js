function m(c,i,a,r,e,n,o){try{var u=c[n](o),s=u.value}catch(t){a(t);return}u.done?i(s):Promise.resolve(s).then(r,e)}function p(c){return function(){var i=this,a=arguments;return new Promise(function(r,e){var n=c.apply(i,a);function o(s){m(n,r,e,o,u,"next",s)}function u(s){m(n,r,e,o,u,"throw",s)}o(void 0)})}}function S(c,i,a){return i in c?Object.defineProperty(c,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):c[i]=a,c}function v(c){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?arguments[i]:{},r=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(e){S(c,e,a[e])})}return c}function P(c,i){var a=Object.keys(c);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(c);i&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(c,e).enumerable})),a.push.apply(a,r)}return a}function g(c,i){return i=i??{},Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(i)):P(Object(i)).forEach(function(a){Object.defineProperty(c,a,Object.getOwnPropertyDescriptor(i,a))}),c}function j(c){"@swc/helpers - typeof";return c&&typeof Symbol<"u"&&c.constructor===Symbol?"symbol":typeof c}function w(c,i){var a,r,e,n={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=u(0),o.throw=u(1),o.return=u(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(t){return function(l){return s([t,l])}}function s(t){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,t[0]&&(n=0)),n;)try{if(a=1,r&&(e=t[0]&2?r.return:t[0]?r.throw||((e=r.return)&&e.call(r),0):r.next)&&!(e=e.call(r,t[1])).done)return e;switch(r=0,e&&(t=[t[0]&2,e.value]),t[0]){case 0:case 1:e=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,r=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(e=n.trys,!(e=e.length>0&&e[e.length-1])&&(t[0]===6||t[0]===2)){n=0;continue}if(t[0]===3&&(!e||t[1]>e[0]&&t[1]<e[3])){n.label=t[1];break}if(t[0]===6&&n.label<e[1]){n.label=e[1],e=t;break}if(e&&n.label<e[2]){n.label=e[2],n.ops.push(t);break}e[2]&&n.ops.pop(),n.trys.pop();continue}t=i.call(c,n)}catch(l){t=[6,l],r=0}finally{a=e=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}var d=null;function x(){return p(function(){var c,i,a;return w(this,function(r){switch(r.label){case 0:if(d)return[2,d];r.label=1;case 1:return r.trys.push([1,4,,5]),[4,fetch("/admin/api/csrf-token")];case 2:if(c=r.sent(),!c.ok)throw new Error("Failed to fetch CSRF token");return[4,c.json()];case 3:return i=r.sent(),d=i.csrf_token,[2,d];case 4:throw a=r.sent(),console.error("Error fetching CSRF token:",a),a;case 5:return[2]}})})()}function y(c){return p(function(i){var a,r,e,n=arguments;return w(this,function(o){switch(o.label){case 0:return a=n.length>1&&n[1]!==void 0?n[1]:{},[4,x()];case 1:return r=o.sent(),e=g(v({},a.headers),{"X-CSRF-Token":r}),a.body&&j(a.body)==="object"&&(e["Content-Type"]="application/json",a.body=JSON.stringify(a.body)),[2,fetch(i,g(v({},a),{headers:e}))]}})}).apply(this,arguments)}function O(c,i,a,r,e,n,o){try{var u=c[n](o),s=u.value}catch(t){a(t);return}u.done?i(s):Promise.resolve(s).then(r,e)}function h(c){return function(){var i=this,a=arguments;return new Promise(function(r,e){var n=c.apply(i,a);function o(s){O(n,r,e,o,u,"next",s)}function u(s){O(n,r,e,o,u,"throw",s)}o(void 0)})}}function E(c,i){return i!=null&&typeof Symbol<"u"&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](c):c instanceof i}function b(c,i){var a,r,e,n={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=u(0),o.throw=u(1),o.return=u(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(t){return function(l){return s([t,l])}}function s(t){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,t[0]&&(n=0)),n;)try{if(a=1,r&&(e=t[0]&2?r.return:t[0]?r.throw||((e=r.return)&&e.call(r),0):r.next)&&!(e=e.call(r,t[1])).done)return e;switch(r=0,e&&(t=[t[0]&2,e.value]),t[0]){case 0:case 1:e=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,r=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(e=n.trys,!(e=e.length>0&&e[e.length-1])&&(t[0]===6||t[0]===2)){n=0;continue}if(t[0]===3&&(!e||t[1]>e[0]&&t[1]<e[3])){n.label=t[1];break}if(t[0]===6&&n.label<e[1]){n.label=e[1],e=t;break}if(e&&n.label<e[2]){n.label=e[2],n.ops.push(t);break}e[2]&&n.ops.pop(),n.trys.pop();continue}t=i.call(c,n)}catch(l){t=[6,l],r=0}finally{a=e=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}function I(c){return h(function(){var i,a,r,e;return b(this,function(n){switch(n.label){case 0:if(!confirm('Are you sure you want to delete credential "'.concat(c,'"?')))return[2];n.label=1;case 1:return n.trys.push([1,5,,6]),[4,y("/admin/api/credentials/".concat(c),{method:"DELETE"})];case 2:return i=n.sent(),i.ok?[3,4]:[4,i.text()];case 3:throw a=n.sent(),new Error("Failed to delete credential: ".concat(a));case 4:return window.location.href="/admin/identities",[3,6];case 5:return r=n.sent(),console.error("Error deleting credential:",r),e=E(r,Error)?r.message:String(r),alert("Error deleting credential: ".concat(e)),[3,6];case 6:return[2]}})})()}function _(c,i,a){return h(function(){var r,e,n,o,u,s,t;return b(this,function(l){switch(l.label){case 0:return l.trys.push([0,5,,6]),r=a?"/admin/api/credentials/".concat(c):"/admin/api/credentials",e=a?"PUT":"POST",n=a?{secret_access_key:i}:{access_key_id:c,secret_access_key:i},[4,y(r,{method:e,body:n})];case 1:return o=l.sent(),o.ok?[3,3]:[4,o.text()];case 2:throw u=l.sent(),new Error("Failed to save credential: ".concat(u));case 3:return[4,o.json()];case 4:return s=l.sent(),[2,s];case 5:throw t=l.sent(),console.error("Error saving credential:",t),t;case 6:return[2]}})})()}function C(){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="",a=new Uint8Array(40);crypto.getRandomValues(a);for(var r=0;r<40;r++)i+=c[a[r]%c.length];return i}function D(){var c=document.getElementById("credential-form");if(c){var i=document.getElementById("access-key-id"),a=document.getElementById("secret-access-key"),r=document.getElementById("generate-key-btn"),e=document.getElementById("toggle-visibility-btn");r&&r.addEventListener("click",function(n){n.preventDefault();var o=C();a.value=o,a.type="text"}),e&&e.addEventListener("click",function(n){n.preventDefault(),a.type=a.type==="password"?"text":"password"}),c.addEventListener("submit",function(n){return h(function(){var o,u,s,t,l;return b(this,function(f){switch(f.label){case 0:if(n.preventDefault(),o=i.value.trim(),u=a.value,s=i.hasAttribute("readonly"),u.length!==40)return alert("Secret access key must be exactly 40 characters long"),[2];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,_(o,u,s)];case 2:return f.sent(),alert("Credential saved successfully!"),window.location.href="/admin/identities/".concat(o),[3,4];case 3:return t=f.sent(),l=E(t,Error)?t.message:String(t),alert("Error: ".concat(l)),[3,4];case 4:return[2]}})})()})}}function B(){var c=document.getElementById("delete-credential-btn");c&&c.addEventListener("click",function(i){i.preventDefault();var a=c.dataset.accessKeyId;a&&I(a)})}function k(){D(),B()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k();
