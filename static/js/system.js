function m(a,u,c,t,e,n,o){try{var i=a[n](o),s=i.value}catch(r){c(r);return}i.done?u(s):Promise.resolve(s).then(t,e)}function h(a){return function(){var u=this,c=arguments;return new Promise(function(t,e){var n=a.apply(u,c);function o(s){m(n,t,e,o,i,"next",s)}function i(s){m(n,t,e,o,i,"throw",s)}o(void 0)})}}function E(a,u,c){return u in a?Object.defineProperty(a,u,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[u]=c,a}function y(a){for(var u=1;u<arguments.length;u++){var c=arguments[u]!=null?arguments[u]:{},t=Object.keys(c);typeof Object.getOwnPropertySymbols=="function"&&(t=t.concat(Object.getOwnPropertySymbols(c).filter(function(e){return Object.getOwnPropertyDescriptor(c,e).enumerable}))),t.forEach(function(e){E(a,e,c[e])})}return a}function k(a,u){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(a);u&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),c.push.apply(c,t)}return c}function b(a,u){return u=u??{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(u)):k(Object(u)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(u,c))}),a}function S(a){"@swc/helpers - typeof";return a&&typeof Symbol<"u"&&a.constructor===Symbol?"symbol":typeof a}function g(a,u){var c,t,e,n={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=i(0),o.throw=i(1),o.return=i(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function i(r){return function(l){return s([r,l])}}function s(r){if(c)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(n=0)),n;)try{if(c=1,t&&(e=r[0]&2?t.return:r[0]?t.throw||((e=t.return)&&e.call(t),0):t.next)&&!(e=e.call(t,r[1])).done)return e;switch(t=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return n.label++,{value:r[1],done:!1};case 5:n.label++,t=r[1],r=[0];continue;case 7:r=n.ops.pop(),n.trys.pop();continue;default:if(e=n.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){n=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){n.label=r[1];break}if(r[0]===6&&n.label<e[1]){n.label=e[1],e=r;break}if(e&&n.label<e[2]){n.label=e[2],n.ops.push(r);break}e[2]&&n.ops.pop(),n.trys.pop();continue}r=u.call(a,n)}catch(l){r=[6,l],t=0}finally{c=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}}var f=null;function P(){return h(function(){var a,u,c;return g(this,function(t){switch(t.label){case 0:if(f)return[2,f];t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch("/admin/api/csrf-token")];case 2:if(a=t.sent(),!a.ok)throw new Error("Failed to fetch CSRF token");return[4,a.json()];case 3:return u=t.sent(),f=u.csrf_token,[2,f];case 4:throw c=t.sent(),console.error("Error fetching CSRF token:",c),c;case 5:return[2]}})})()}function v(a){return h(function(u){var c,t,e,n=arguments;return g(this,function(o){switch(o.label){case 0:return c=n.length>1&&n[1]!==void 0?n[1]:{},[4,P()];case 1:return t=o.sent(),e=b(y({},c.headers),{"X-CSRF-Token":t}),c.body&&S(c.body)==="object"&&(e["Content-Type"]="application/json",c.body=JSON.stringify(c.body)),[2,fetch(u,b(y({},c),{headers:e}))]}})}).apply(this,arguments)}function p(a,u,c,t,e,n,o){try{var i=a[n](o),s=i.value}catch(r){c(r);return}i.done?u(s):Promise.resolve(s).then(t,e)}function w(a){return function(){var u=this,c=arguments;return new Promise(function(t,e){var n=a.apply(u,c);function o(s){p(n,t,e,o,i,"next",s)}function i(s){p(n,t,e,o,i,"throw",s)}o(void 0)})}}function O(a,u){var c,t,e,n={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=i(0),o.throw=i(1),o.return=i(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function i(r){return function(l){return s([r,l])}}function s(r){if(c)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(n=0)),n;)try{if(c=1,t&&(e=r[0]&2?t.return:r[0]?t.throw||((e=t.return)&&e.call(t),0):t.next)&&!(e=e.call(t,r[1])).done)return e;switch(t=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return n.label++,{value:r[1],done:!1};case 5:n.label++,t=r[1],r=[0];continue;case 7:r=n.ops.pop(),n.trys.pop();continue;default:if(e=n.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){n=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){n.label=r[1];break}if(r[0]===6&&n.label<e[1]){n.label=e[1],e=r;break}if(e&&n.label<e[2]){n.label=e[2],n.ops.push(r);break}e[2]&&n.ops.pop(),n.trys.pop();continue}r=u.call(a,n)}catch(l){r=[6,l],t=0}finally{c=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}}function x(){return w(function(){var a,u,c;return O(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,fetch("/admin/api/database/vacuum")];case 1:if(a=t.sent(),!a.ok)throw new Error("Failed to fetch vacuum stats");return[4,a.json()];case 2:return u=t.sent(),j(u),[3,4];case 3:return c=t.sent(),console.error("Error loading vacuum stats:",c),d("Failed to load vacuum statistics"),[3,4];case 4:return[2]}})})()}function j(a){var u=document.getElementById("vacuum-status"),c=document.getElementById("page-count"),t=document.getElementById("freelist-count"),e=document.getElementById("freelist-percentage"),n=document.getElementById("vacuum-btn");u&&c&&t&&e&&n&&(a.needs_vacuum?(u.textContent="Vacuum Recommended",u.className="badge badge-deny",n.disabled=!1):(u.textContent="Healthy",u.className="badge badge-allow",n.disabled=!0),c.textContent=a.page_count.toLocaleString(),t.textContent=a.freelist_count.toLocaleString(),e.textContent="".concat(a.percentage.toFixed(2),"%"))}function C(){return w(function(){var a,u,c,t,e;return O(this,function(n){switch(n.label){case 0:if(a=document.getElementById("vacuum-btn"),u=document.getElementById("vacuum-result"),!a||!u)return[2];a.disabled=!0,a.textContent="Vacuuming...",u.style.display="none",n.label=1;case 1:return n.trys.push([1,7,8,9]),[4,v("/admin/api/database/vacuum?confirm=true",{method:"POST"})];case 2:if(c=n.sent(),!c.ok)throw new Error("Vacuum operation failed");return[4,c.json()];case 3:return t=n.sent(),t.success?(I("Vacuum completed successfully. Reclaimed ".concat(t.reclaimed_pages," pages.")),[4,x()]):[3,5];case 4:return n.sent(),[3,6];case 5:d(t.error||"Vacuum operation failed"),n.label=6;case 6:return[3,9];case 7:return e=n.sent(),console.error("Error executing vacuum:",e),d("Failed to execute vacuum operation"),[3,9];case 8:return a.textContent="Vacuum Database",[7];case 9:return[2]}})})()}function I(a){var u=document.getElementById("vacuum-result");u&&(u.textContent=a,u.className="message success",u.style.display="block")}function d(a){var u=document.getElementById("vacuum-result");u&&(u.textContent=a,u.className="message error",u.style.display="block")}document.addEventListener("DOMContentLoaded",function(){x();var a=document.getElementById("vacuum-btn");a&&a.addEventListener("click",C)});
